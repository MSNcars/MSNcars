# MSNcars - car selling platform

## Sample use cases

- #### Browsing through listings (and sorting / filtering)

- #### Adding new listing as user

- #### Creating your company (and managing your company)

- #### Working as a employee in company

- #### Managing your listings

- #### Blocking users

### Containers and workflows overview
![containers](https://github.com/user-attachments/assets/02474857-6ef3-477f-ae56-87929fb2f3a0)


### Authentication
To send authenticated request, you first need to register and login. Login requests are routed to Keycloak through Nginx. After successfull login, you will receive token in response that will be valid for 5 minutes.

### Storing images
Images are stored in MinIO object storage solution. Images for each listing are stored in separate "folder", using prefix.

### Car model fetching from external API
[Car Uploader](https://github.com/MSNcars/MSNcars/tree/master/src/main/java/com/msn/msncars/car/update)

Fetching models and makes is done using scheduled task that runs every 24 hours.

To disable car fetching set `car.uploader.suspend=false` in application.properties.

External API consists of more than 30 000 car models, to limit number of models that will be fetched (useful in dev environment) set `car.uploader.limit` to designated number.

### Github actions
[Workflows](https://github.com/MSNcars/MSNcars/tree/master/.github/workflows)
- docker.yml - building and pushing image to registry
- maven.yml - compiling code and running unit/integration tests
- snyk.yml - running snyk scans

### ELK
To view logs go to `localhost:5601` (kibana). Then select `Elasticsearch` > `Index Management` or use `Analitics` > `Discover`.

Spring Boot app
    → logs events using slf4j with logback →
[ Logstash - reads logs ]
    → sends to →
[ Elasticsearch - stores and query ]
    → viewed in →
[ Kibana ]


### Prometheus + Grafana
To view metrics go to `localhost:9090` (prometheus) and type query or go to `localhost:3000` graphana and create dashboard.  

Spring Boot app exposes metrics using actuator endpoint (/actuator/prometheus) → Prometheus scrapes metrics every 15 seconds → Grafana visualises metrics from Prometheus

### Swagger documentation
[Swagger](http://localhost:8080/swagger-ui/index.html)

Swagger provides documentation for all available endpoints in our application.
Although authentication is handled externally by Keycloak, 
the login endpoint is manually documented to allow users to obtain a JWT token for authorized requests.
Endpoints requiring authentication are marked with a lock icon and require a valid JWT token, 
which can be provided using the “Authorize” button at the top of the Swagger UI.
Swagger is configured to work with nginx, 
mirroring the application's deployment setup where nginx routes requests to appropriate services. 
Most responses, including common ones like 200 OK and 401 Unauthorized, are documented.

### Flyway database migration
We use Flyway to manage and version-control database schema changes, ensuring consistency across environments.
Our application is configured to validate that the schema generated by Hibernate matches the schema defined by Flyway migrations.

Flyway tracks applied migrations using a dedicated table 
in the database and automatically applies any pending migrations on application startup.
This approach simplifies database management, 
reduces the risk of inconsistencies, 
and helps maintain a consistent and reliable application state.

### Running performance tests using Gatling and scalability with nginx + multiple containers
In our setup, gatling simulates a specified number of users performing defined scenarios over a given time period. 
For example, we can simulate 100 users executing one scenario each within 30 seconds, 
allowing us to measure how the system behaves under load.

Below is link to readme that describes how to run gatling tests:

[Gatling Tests Readme](https://github.com/MSNcars/MSNcars/tree/master/src/test/java/com/msn/msncars/gatling)
